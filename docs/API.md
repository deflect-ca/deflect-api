# Deflect Core API Documentation

## API Authentication

API token should be provided via header

    Authorization: Bearer 9944b09199c62bcf9418ad846dd0e4bbdfc6ee4b

Token could be generated by:

1. Django admin panel
2. `python manage.py drf_create_token <username>`
3. POST `http://localhost:8000/api-token-auth/` with field `username` and `password`

## API Implementation

### GET `/api/edge/list`

#### Param

- dnet

Equivalent to command `edge_query --dnet dnet1`

#### Sample output

```
[
    {
        "edgename": "one22.prod.deflect.ca",
        "mode": "available",
        "state": "out",
        "health": "pass",
        "state_time": -1,
        "comment": null
    }
]
```

### POST `/api/edge/dnet`

List all available dnet

#### Sample output

```
[
    'dnet1',
    'dnet2',
    'dnet3'
]
```


### POST `/api/edge/config`

#### Param

1. dnet
2. edge: edge hostname
3. mode: available / unavailable
4. comment
5. comment_user

#### Sample output

```
{
    "edge": "lime20.prod.deflect.ca",
    "prev_state": {
        "mode": "available",
        "comment": "[jeremy_pm] hi hi"
    },
    "current_state": {
        "mode": "available",
        "comment": "[jeremy_pm] hi hi"
    }
}
```
